<div class="policies-container">
    <h2>My Policies</h2>

    <div
        style="background: #f0f0f0; padding: 10px; margin-bottom: 20px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
        <p style="margin: 0;"><strong>Logged In As:</strong> {{
            currentUser?.['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress'] }}</p>

        <mat-form-field appearance="outline" style="width: 300px; font-size: 14px; margin-bottom: -1.25em;">
            <mat-label>Search Policies</mat-label>
            <input matInput (keyup)="onSearch($event)" placeholder="Policy #, Plan...">
            <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
    </div>

    <div *ngIf="errorMessage"
        style="color: red; background: #fff0f0; padding: 10px; border: 1px solid red; margin-bottom: 20px;">
        {{ errorMessage }}
    </div>

    <div class="mat-elevation-z8" *ngIf="policies && policies.length > 0; else noPolicies">
        <table mat-table [dataSource]="policies" matSort (matSortChange)="onSortChange($event)">

            <ng-container matColumnDef="policyNumber">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Policy Number </th>
                <td mat-cell *matCellDef="let policy"> {{policy.policyNumber}} </td>
            </ng-container>

            <ng-container matColumnDef="planName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Plan </th>
                <td mat-cell *matCellDef="let policy"> {{policy.planName}} </td>
            </ng-container>

            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
                <td mat-cell *matCellDef="let policy"> {{policy.status}} </td>
            </ng-container>

            <ng-container matColumnDef="premium">
                <th mat-header-cell *matHeaderCellDef> Premium </th>
                <td mat-cell *matCellDef="let policy"> {{policy.premiumAmount | currency:'INR'}} </td>
            </ng-container>

            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef> Actions </th>
                <td mat-cell *matCellDef="let policy">
                    <button mat-raised-button color="primary" *ngIf="!policy.premiumPaid" (click)="payPremium(policy)">
                        Pay Premium
                    </button>
                    <button mat-button disabled *ngIf="policy.premiumPaid">Paid</button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <mat-paginator [length]="totalCount" [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 25]"
            (page)="onPageChange($event)" aria-label="Select page">
        </mat-paginator>
    </div>

    <ng-template #noPolicies>
        <div style="padding: 20px; border: 2px dashed gray; text-align: center;">
            <p>No active policies found.</p>
        </div>
    </ng-template>
</div>